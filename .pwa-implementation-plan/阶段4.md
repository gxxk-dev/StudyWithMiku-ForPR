# é˜¶æ®µ4ï¼šå¯é€‰å¢å¼ºï¼ˆå¯é€‰ï¼‰

## å¢å¼ºéŸ³ä¹ API ç¦»çº¿å›é€€

ä¿®æ”¹ `src/services/meting.js`ï¼Œåœ¨ `fetchPlaylist` å‡½æ•°ä¸­æ·»åŠ  localStorage ç¼“å­˜ï¼š

```javascript
export const fetchPlaylist = async (server = 'netease', id = DEFAULT_PLAYLIST_ID) => {
  const url = `${METING_API}?server=${server}&type=playlist&id=${id}`
  const cacheKey = `playlist_${server}_${id}`

  try {
    const response = await fetch(url)
    if (!response.ok) throw new Error('ç½‘ç»œé”™è¯¯')

    const data = await response.json()
    const playlist = data.map(song => ({
      name: song.title || song.name,
      artist: song.author || song.artist,
      url: song.url,
      cover: song.pic || song.cover,
      lrc: song.lrc
    }))

    // ç¼“å­˜æˆåŠŸå“åº”
    try {
      localStorage.setItem(cacheKey, JSON.stringify({
        data: playlist,
        timestamp: Date.now()
      }))
    } catch (e) {
      console.warn('æ— æ³•ç¼“å­˜æ’­æ”¾åˆ—è¡¨')
    }

    return playlist
  } catch (error) {
    console.error('Meting API é”™è¯¯:', error)

    // å°è¯•ä»ç¼“å­˜åŠ è½½
    try {
      const cached = localStorage.getItem(cacheKey)
      if (cached) {
        const { data, timestamp } = JSON.parse(cached)
        // ä½¿ç”¨ 7 å¤©å†…çš„ç¼“å­˜
        if (Date.now() - timestamp < 7 * 24 * 60 * 60 * 1000) {
          console.log('âœ“ ä½¿ç”¨ç¼“å­˜çš„æ’­æ”¾åˆ—è¡¨')
          return data
        }
      }
    } catch (e) {
      console.warn('æ— æ³•åŠ è½½ç¼“å­˜')
    }

    return []
  }
}
```

**æ•ˆæœï¼š** éŸ³ä¹æ’­æ”¾åˆ—è¡¨åœ¨ç¦»çº¿æ—¶ä¹Ÿèƒ½ä½¿ç”¨ï¼ˆå¦‚æœä¹‹å‰åŠ è½½è¿‡ï¼‰

---

**å®Œæˆï¼ç°åœ¨æ‚¨çš„åº”ç”¨å·²ç»æ˜¯å®Œæ•´çš„ PWA äº† ğŸ‰**

## åç»­å»ºè®®

1. **éƒ¨ç½²å‰æ£€æŸ¥ï¼š** ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS
2. **CDN é…ç½®ï¼š** ç¡®ä¿ Service Worker ä¸è¢«è¿‡åº¦ç¼“å­˜ï¼ˆCache-Control: no-cacheï¼‰
3. **ç›‘æ§ï¼š** å…³æ³¨ç”¨æˆ·å®‰è£…ç‡å’Œç¦»çº¿ä½¿ç”¨æƒ…å†µ

## å¸¸è§é—®é¢˜

**Q: Service Worker æ²¡æœ‰æ›´æ–°ï¼Ÿ**
A: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œæˆ–åœ¨ DevTools â†’ Application â†’ Service Workers â†’ Unregister

**Q: iOS Safari æ— æ³•ç¼“å­˜å¤§è§†é¢‘ï¼Ÿ**
A: iOS æœ‰ç¼“å­˜é…é¢é™åˆ¶ï¼ŒService Worker ä¼šå°½åŠ›ç¼“å­˜ï¼Œä½†å¯èƒ½éœ€è¦åœ¨çº¿è®¿é—®

**Q: å¦‚ä½•å¼ºåˆ¶ç”¨æˆ·æ›´æ–°ï¼Ÿ**
A: å½“å‰é…ç½®å·²è®¾ç½®è‡ªåŠ¨æ›´æ–°ï¼ˆautoUpdateï¼‰ï¼Œç”¨æˆ·åˆ·æ–°é¡µé¢å³å¯è·å–æœ€æ–°ç‰ˆæœ¬
